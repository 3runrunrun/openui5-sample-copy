sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/core/mvc/Controller","sap/ui/demo/todo/controller/App.controller","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/Device"],function(t,e,o,i,r,s){"use strict";QUnit.module("Test init state",{beforeEach:function(){this.oAppController=new o;this.oViewStub=new t({});sinon.stub(e.prototype,"getView").returns(this.oViewStub);this.oJSONModelStub=new i({todos:[]});this.oViewStub.setModel(this.oJSONModelStub)},afterEach:function(){e.prototype.getView.restore();this.oViewStub.destroy()}});QUnit.test("Check controller's initial state",function(t){this.oAppController.onInit();t.deepEqual(this.oAppController.aSearchFilters,[],"Search filters have been instantiated empty");t.deepEqual(this.oAppController.aTabFilters,[],"Tab filters have been instantiated empty");var e=this.oAppController.getView().getModel("view").getData();t.deepEqual(e,{isMobile:s.browser.mobile,filterText:undefined})});QUnit.module("Test model modification",{beforeEach:function(){this.oAppController=new o;this.oViewStub=new t({});sinon.stub(e.prototype,"getView").returns(this.oViewStub);this.oJSONModelStub=new i({todos:[]});this.oViewStub.setModel(this.oJSONModelStub)},afterEach:function(){e.prototype.getView.restore();this.oViewStub.destroy()}});QUnit.test("Should add a todo element to the model",function(t){t.strictEqual(this.oJSONModelStub.getObject("/todos").length,0,"There must be no todos defined.");this.oJSONModelStub.setProperty("/todos",[{title:"Completed item",completed:true}]);this.oJSONModelStub.setProperty("/newTodo","new todo item");this.oAppController.addTodo();t.strictEqual(this.oJSONModelStub.getObject("/todos").length,2,"There are couple items in ToDo list.")});QUnit.test("Should toggle the completed items in the model",function(t){var e={todos:[{title:"Start this app",completed:false}],itemsLeftCount:1};this.oJSONModelStub.setData(e);t.strictEqual(this.oJSONModelStub.getObject("/todos").length,1,"There is one item.");t.strictEqual(this.oJSONModelStub.getProperty("/itemsLeftCount"),1,"There is one item left.");this.oJSONModelStub.setProperty("/todos/0/completed",true);this.oAppController.updateItemsLeftCount();t.strictEqual(this.oJSONModelStub.getProperty("/itemsLeftCount"),0,"There is no item left.")});QUnit.test("Should clear the completed items",function(t){var e={todos:[{title:"Start this app1",completed:false},{title:"Start this app2",completed:true}],itemsLeftCount:1};this.oJSONModelStub.setData(e);t.strictEqual(this.oJSONModelStub.getObject("/todos").length,2,"There are two items.");t.strictEqual(this.oJSONModelStub.getProperty("/itemsLeftCount"),1,"There is no item left.");this.oAppController.clearCompleted();this.oAppController.updateItemsLeftCount();t.strictEqual(this.oJSONModelStub.getObject("/todos").length,1,"There is one item left.");t.strictEqual(this.oJSONModelStub.getProperty("/itemsLeftCount"),1,"There is one item left.")});QUnit.test("Should update items left count when no todos are loaded, yet",function(t){var e={};this.oJSONModelStub.setData(e);t.strictEqual(this.oJSONModelStub.getObject("/todos"),undefined,"There are no items.");t.strictEqual(this.oJSONModelStub.getProperty("/itemsLeftCount"),undefined,"Items left is not set");this.oAppController.updateItemsLeftCount();t.strictEqual(this.oJSONModelStub.getProperty("/itemsLeftCount"),0,"There is no item left.")});QUnit.module("Test search",{beforeEach:function(){this.oAppController=new o;this.oViewStub=new t({});this.oListStub=new t({});sinon.stub(e.prototype,"getView").returns(this.oViewStub);sinon.stub(e.prototype,"byId").returns(this.oListStub);sinon.stub(this.oListStub,"getBinding").returns({filter:function(){}});this.oJSONModelStub=new i({todos:[]});this.oViewStub.setModel(this.oJSONModelStub);this.oViewStub.setModel(new i({}),"view");this.oViewStub.setModel(new r({bundleName:"sap.ui.demo.todo.i18n.i18n"}),"i18n")},afterEach:function(){e.prototype.getView.restore();e.prototype.byId.restore();this.oViewStub.destroy();this.oListStub.destroy()}});QUnit.test("Empty search",function(t){var e={getSource:function(){return{getValue:function(){return""}}}};this.oAppController.onSearch(e);t.strictEqual(this.oAppController.sSearchQuery,"","The search term is an empty string");t.deepEqual(this.oAppController.aSearchFilters,[],"Search filters are empty");t.strictEqual(this.oAppController.getView().getModel().getProperty("/itemsRemovable"),true,"Button toggle is properly set")});QUnit.test("Do a search",function(t){var e="ToDo item";var o={getSource:function(){return{getValue:function(){return e}}}};this.oAppController.onSearch(o);t.strictEqual(this.oAppController.sSearchQuery,e,"The search term is an empty string");t.strictEqual(this.oAppController.aSearchFilters.length,1,"A search filter is constructed");t.strictEqual(this.oAppController.getView().getModel().getProperty("/itemsRemovable"),false,"Button toggle is properly set")});QUnit.module("Test filtering",{beforeEach:function(){this.oAppController=new o;this.oViewStub=new t({});this.oListStub=new t({});sinon.stub(e.prototype,"getView").returns(this.oViewStub);sinon.stub(e.prototype,"byId").returns(this.oListStub);sinon.stub(this.oListStub,"getBinding").returns({filter:function(){}});this.oJSONModelStub=new i({todos:[]});this.oViewStub.setModel(this.oJSONModelStub);this.oViewStub.setModel(new i({}),"view");this.oViewStub.setModel(new r({bundleName:"sap.ui.demo.todo.i18n.i18n"}),"i18n")},afterEach:function(){e.prototype.getView.restore();e.prototype.byId.restore();this.oViewStub.destroy();this.oListStub.destroy()}});QUnit.test("Toggle filters",function(t){var e="";var o={getParameter:function(){return{getKey:function(){return e}}}};this.oAppController.aSearchFilters=[];this.oAppController.onFilter(o);t.strictEqual(this.oAppController.sFilterKey,e,"Correct filter key is applied");t.strictEqual(this.oAppController.aTabFilters.length,0,"Empty key == no filter");e="active";this.oAppController.onFilter(o);t.strictEqual(this.oAppController.sFilterKey,e,"Correct filter key is applied");t.strictEqual(this.oAppController.aTabFilters.length,1,"A filter is constructed");e="completed";this.oAppController.onFilter(o);t.strictEqual(this.oAppController.sFilterKey,e,"Correct filter key is applied");t.strictEqual(this.oAppController.aTabFilters.length,1,"A filter is constructed");e="completed";this.oAppController.sSearchQuery="test";this.oAppController.onFilter(o);t.strictEqual(this.oAppController.sFilterKey,e,"Correct filter key is applied");t.strictEqual(this.oAppController.aTabFilters.length,1,"A filter is constructed");e="all";this.oAppController.onFilter(o);t.strictEqual(this.oAppController.sFilterKey,e,"Correct filter key is applied");t.strictEqual(this.oAppController.aTabFilters.length,0,"Cleans up filters")})});
//# sourceMappingURL=App.controller.js.map